{"version":3,"file":"userAttributeTransform.js","names":["TYPE_USER_ATTRIBUTE","findUserAttribute","updateAttributeValue","node","userAttributes","type","userAttribute","attributeName","_objectSpread","attributeValue","value","userAttributeTransform","root","length","workingRoot","pointer","right","left"],"sources":["../../../../src/utils/transform/userAttributeTransform.ts"],"sourcesContent":["/**\n * Copyright (c) 2023 Google LLC\n * SPDX-License-Identifier: MIT\n */\nimport type { FilterASTNode, UserAttributeWithValue } from '../../types';\nimport { TYPE_USER_ATTRIBUTE } from '../../types';\nimport { findUserAttribute } from '../user_attribute';\n\n/**\n * sets the userAttributeValue on a node with type 'user_attribute'\n */\nconst updateAttributeValue = (\n  node: FilterASTNode,\n  userAttributes: UserAttributeWithValue[]\n): FilterASTNode => {\n  if (node && node.type === TYPE_USER_ATTRIBUTE) {\n    const userAttribute = findUserAttribute(node.attributeName, userAttributes);\n    return {\n      ...node,\n      attributeValue: userAttribute && userAttribute.value,\n    } as FilterASTNode;\n  }\n  return node;\n};\n\n/**\n * Traverses ast and updates userAttribute value\n */\nexport const userAttributeTransform =\n  (userAttributes?: UserAttributeWithValue[]) =>\n  (root: FilterASTNode): FilterASTNode => {\n    if (!userAttributes || !userAttributes.length) return root;\n\n    const workingRoot = updateAttributeValue(root, userAttributes);\n    let pointer = workingRoot;\n    while (pointer.right) {\n      pointer.left =\n        pointer.left && updateAttributeValue(pointer.left, userAttributes);\n      pointer.right = updateAttributeValue(pointer.right, userAttributes);\n      pointer = pointer.right;\n    }\n    return workingRoot;\n  };\n"],"mappings":";;;;;AAKA,SAASA,mBAAmB,QAAQ,aAAa;AACjD,SAASC,iBAAiB,QAAQ,mBAAmB;AAKrD,MAAMC,oBAAoB,GAAGA,CAC3BC,IAAmB,EACnBC,cAAwC,KACtB;EAClB,IAAID,IAAI,IAAIA,IAAI,CAACE,IAAI,KAAKL,mBAAmB,EAAE;IAC7C,MAAMM,aAAa,GAAGL,iBAAiB,CAACE,IAAI,CAACI,aAAa,EAAEH,cAAc,CAAC;IAC3E,OAAAI,aAAA,CAAAA,aAAA,KACKL,IAAI;MACPM,cAAc,EAAEH,aAAa,IAAIA,aAAa,CAACI;IAAK;EAExD;EACA,OAAOP,IAAI;AACb,CAAC;AAKD,OAAO,MAAMQ,sBAAsB,GAChCP,cAAyC,IACzCQ,IAAmB,IAAoB;EACtC,IAAI,CAACR,cAAc,IAAI,CAACA,cAAc,CAACS,MAAM,EAAE,OAAOD,IAAI;EAE1D,MAAME,WAAW,GAAGZ,oBAAoB,CAACU,IAAI,EAAER,cAAc,CAAC;EAC9D,IAAIW,OAAO,GAAGD,WAAW;EACzB,OAAOC,OAAO,CAACC,KAAK,EAAE;IACpBD,OAAO,CAACE,IAAI,GACVF,OAAO,CAACE,IAAI,IAAIf,oBAAoB,CAACa,OAAO,CAACE,IAAI,EAAEb,cAAc,CAAC;IACpEW,OAAO,CAACC,KAAK,GAAGd,oBAAoB,CAACa,OAAO,CAACC,KAAK,EAAEZ,cAAc,CAAC;IACnEW,OAAO,GAAGA,OAAO,CAACC,KAAK;EACzB;EACA,OAAOF,WAAW;AACpB,CAAC"}